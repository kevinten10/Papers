window.Demandbase=window.Demandbase||{},window.Demandbase.SiteOptimization={CLASS_CLOSED:"closed",CLASS_CLOSE_BUTTON:"recommended-block__close-button",CLASS_CLOSED_CONTENT:"recommended-block_closed__content",CLASS_HIDDEN:"_hidden",CLASS_LIST_WRAP:"recommended-block__list-wrapper",CLASS_LIST:"recommended-block__list",CLASS_LIST_ITEM:"recommended-block__list__recommended-item",CLASS_LIST_ITEM_TITLE:"recommended-block__list__recommended-item__title",CLASS_LOGO_WRAPPER:"recommended-block__logo-wrapper",CLASS_MAIN_BOTTOM:"BottomAlignedBlock",CLASS_MAIN_DEFAULT:"defaultBlock",CLASS_OPENED:"opened",CLASS_OPEN_CONTENT:"recommended-block_opened__content",CLASS_OPEN_TITLE:"recommended-block_open__title",CLASS_OPEN_TITLE_WRAPPER:"recommended-block_open__title-wrapper",CLASS_RIGHT_RAIL:"RightRail",CLASS_ROOT:"recommended-block",CLASS_SWITCHER_CONTROL:"recommended-block__slider__switchers",CLASS_SWITCHER_CONTROL_ITEM:"recommended-block__slider__switchers-item",CLASS_SWITCHER_CONTROL_WRAPPER:"recommended-block__slider__switchers-wrapper",CLASS_TITLE:"recommended-block__title",DIV:"div",SESSION_BLOCK_OPEN_STATE:"openedRecommendationBlock",PERSONALIZATION_BLACKLIST_DOMAINS:["adaptiveinsights.com","workday.com","getpattern.com","platfora.com","rallyteam.com"],DEFAULT_CONFIGURATION:{additionalClass:null,backgroundColorClass:null,closedTitle:"Recommended Content",companyProfile:null,cssFileURL:"https://tag.demandbase.com/shared/siteOptimization.css",delay:0,enabled:!1,fadeIn:0,fontColor:null,fontName:null,googleAnalyticsTrackerName:null,isGoogleAnalyticsEnabled:!1,isRippleAnimation:!0,isSwitchersDots:!0,isSwitchersArrows:!1,itemBackgroundColor:null,mainClass:"defaultBlock",openByDefault:!1,openTitle:null,recommendationApiURL:"https://site-optimization-api.company-target.com/recommend/",recommendationCompanyName:null,recommendationCompanyId:null,recommendationKey:null,recommendationsProtocol:"forceHTTPS",recommendationUrl:window.location.href,showCloseButton:!0,showCompanyName:!0,showFeedbackLink:!1,showIndicatorArrows:!0,showLogo:!0,showLogoWhenClosed:!0,showLogoWhenOpen:!1,showOnlyOnScroll:!1,showTitleWhenClosed:!0,showTitleWhenOpen:!0,switcherArrowsColor:"#444",state:{openedRecommendationBlock:null},widgetBackgroundColor:null,widgetContainerId:null},configuration:{},initialize:function(e){this.isAdmin=this.getQueryVariable("admin"),e&&Object.assign(this.configuration,this.DEFAULT_CONFIGURATION,e),this.insertStylesheet(),this.setGoogleAnalyticsObject(),this.configuration.companyProfile?this.setRecommendationsData(this.configuration.companyProfile):this.checkInitialData()},addAnimation:function(e){if(this.configuration.isRippleAnimation){var t=this,n=document.createElement(this.DIV);this.addClass(n,"animation-ripple-block"),e.appendChild(n);var i=setInterval(function(){if(document.querySelector("."+t.CLASS_ROOT)){var e=document.querySelector(".closed .animation-ripple-block");e&&t.addClass(e,"show-animation"),clearInterval(i)}},100)}},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},addFeedbackClickHandler:function(){var e=document.querySelector(".recommended-block__feedbacklink-wrapper");e&&Demandbase.Utilities.addEventListener(e,"click",this.feedbackLinkClickHandler.bind(this))},addSlidesControls:function(e){this.configuration.isSwitchersDots?(this.addClass(e,"recommended-block__slider-wrapper"),e.appendChild(this.buildSwitchersDots())):this.configuration.isSwitchersArrows&&(this.addClass(e,"recommended-block__slider-arrow-wrapper"),e.appendChild(this.buildSwitchersArrows()))},buildConversionPopup:function(e){var t="Decrease in Chance",n=" decrease_percent",i='<div class="recommendation-block__conversion-popup"><p class="recommendation-block__conversion-popup__title">Where is the AI taking me?</p><ul class="recommendation-block__conversion-popup__conversions">';if(void 0!==e.conversion_pages)for(var o=e.conversion_pages,a=0;a<o.length;a++){var s=o[a];void 0!==s.prob_increase_percentage&&null!==s.prob_increase_percentage&&void 0!==s.conversion_page&&null!==s.conversion_page&&(0<s.prob_increase_percentage&&(t="Increase in Chance",n=""),i+='<li class="recommendation-block__conversion-popup__conversion"><p class="recommendation-block__conversion-popup__conversion__percent-block'+n+'"><span class="recommendation-block__conversion-popup__arrow'+n+'"></span><span class="recommendation-block__conversion-popup__conversion__percent">'+s.prob_increase_percentage+"%</span>"+t+'</p><p class="recommendation-block__conversion-popup__conversion__increase-text">to get customer to:<span class="recommendation-block__conversion-popup__conversion__url">'+s.conversion_page+"</span></p></li>")}return i+="</ul></div>"},buildCloseButton:function(){var e=document.createElement(this.DIV);return e.innerHTML="X",this.addClass(e,this.CLASS_CLOSE_BUTTON),e},buildClosedTitle:function(){var e=document.createElement("p");return e.innerText=this.configuration.closedTitle.trim(),this.addClass(e,this.CLASS_TITLE),e},buildFeedbackLink:function(){var e=document.createElement(this.DIV);return this.addClass(e,"recommended-block__feedbacklink-wrapper"),this.addClass(e,"affect"),e.innerHTML='<p class="recommended-block___contentOfOpenedBlock__feedbackLink_link-text affect">Hey, I\'m not from '+this.configuration.recommendationCompanyName+'.</p><div class="recommended-block__feedbackLinkDiv__popup affect"><span class="recommended-block__feedbackLinkDiv__popup__tile">Enter your company name</span><input type="text" class="recommended-block__feedbackLinkDiv__popup__input" placeholder="Company name"></div>',e},buildOpenedTitle:function(){var e=document.createElement("p"),t=this.getOpenedTitle();return e.innerHTML=t,this.addClass(e,this.CLASS_OPEN_TITLE),e},buildOpenedTitleWrapper:function(e){var t=document.createElement(this.DIV);return e&&t.appendChild(this.buildOpenedTitle()),this.addClass(t,this.CLASS_OPEN_TITLE_WRAPPER),t},buildSlidesList:function(){var e=document.createElement(this.DIV),t=document.createElement("ul");return this.addClass(e,this.CLASS_LIST_WRAP),this.addClass(t,this.CLASS_LIST),e.appendChild(t),this.addSlidesControls(e),e},buildSwitchersArrows:function(){var e=document.createElement(this.DIV);return this.addClass(e,"recommendation-block__arrows-list"),e.innerHTML="",e},buildSwitchersDots:function(){var e=document.createElement(this.DIV);return this.addClass(e,this.CLASS_SWITCHER_CONTROL_WRAPPER),e.innerHTML='<ul class="'+this.CLASS_SWITCHER_CONTROL+'"></ul>',e},feedbackLinkClickCallback:function(){var e=document.querySelector(".recommended-block__feedbackLinkDiv__popup");this.toggleClass(e,"_opened_feedback")},feedbackLinkClickHandler:function(e){this.hasClass(e.target,"recommended-block__feedbackLinkDiv__popup__input")||this.feedbackLinkClickCallback()},feedbackResponseHandler:function(e){200<=e.status&&e.status<400&&this.feedbackSendCallback()},feedbackSendCallback:function(){var e=document.querySelector(".recommended-block__feedbackLinkDiv__popup");this.removeClass(e,"_opened_feedback"),document.querySelector(".recommended-block___contentOfOpenedBlock__feedbackLink_link-text").innerHTML="Thanks for the feedback!",document.querySelector(".recommended-block__feedbackLinkDiv__popup__input").value=""},findAncestor:function(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e},getIndicatorArrow:function(){return this.configuration.showIndicatorArrows?'<span class="link-indicator">â–¶</span>':""},getItemFromStorage:function(e){if(Demandbase.Utilities.isStorageEnabled("sessionStorage"))return window.sessionStorage.getItem(e);if(Demandbase.Utilities.isStorageEnabled("localStorage"))return window.localStorage.getItem(e);if(Demandbase.Utilities.isCookieEnabled())for(var t=document.cookie.split(";"),n=0;n<t.length;n++)if(-1!==t[n].indexOf(e))return t[n].split("=")[1];return this.configuration.state[e]},getOpenedTitle:function(){var e="",t="";return this.configuration.openTitle?e=this.configuration.openTitle.trim()+" ":(e="Recommendations for ",this.configuration.mainClass===this.CLASS_MAIN_DEFAULT&&(e="Here's what we recommend for ")),this.configuration.showCompanyName&&(t="<span class='company-name-wrapper'>"+this.configuration.recommendationCompanyName+"</span>"),e+t},hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},insertStylesheet:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",this.configuration.cssFileURL),void 0!==e&&document.getElementsByTagName("head")[0].appendChild(e)},insertWidget:function(e){if(this.configuration.widgetContainerId)document.getElementById(this.configuration.widgetContainerId)&&document.getElementById(this.configuration.widgetContainerId).appendChild(e);else{var t=document.createElement(this.DIV);t.id="db-ai-personalization-container",t.appendChild(e),document.body.appendChild(t)}},sendGoogleAnalyticsEvent:function(e,t,n){var i=Demandbase.Connectors.Google_Analytics;if(this.configuration.isGoogleAnalyticsEnabled&&i){var o=this.configuration.googleAnalyticsTrackerName;if(!o){var a=i.getTrackerInfo().filter(function(e){return"universal"===e.type});a[0]&&(o=a[0].name)}var s=o?o+".send":"send";window.ga(s,{hitType:"event",eventCategory:e,eventAction:t,eventLabel:n,nonInteraction:!0,transport:"beacon"})}},setFontColor:function(e){var t=void 0!==e?e:this.configuration.fontColor,n=document.getElementsByClassName(this.CLASS_LIST_ITEM_TITLE);if(void 0!==n&&n.length)for(var i=0;i<n.length;i++)n[i].style.color=t;if(this.configuration.showTitleWhenOpen){var o=document.querySelector("."+this.CLASS_OPEN_TITLE_WRAPPER),a=document.querySelector("."+this.CLASS_OPEN_TITLE);a&&o&&(a.style.color=t,o.style.color=t)}if(this.configuration.showTitleWhenClosed){var s=document.querySelector("."+this.CLASS_TITLE);s&&(s.style.color=t)}},setFontFamily:function(e){var t=void 0!==e?e:this.configuration.fontName;document.getElementsByClassName(this.CLASS_ROOT)[0].style.fontFamily=t},setGoogleAnalyticsObject:function(){window.Demandbase.SiteOptimization.configuration.isGoogleAnalyticsEnabled&&void 0===window.ga&&(window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=+new Date)},setItemBackgroundColor:function(e){for(var t=void 0!==e?e:this.configuration.itemBackgroundColor,n=document.getElementsByClassName(this.CLASS_LIST_ITEM),i=0;i<n.length;i++)n[i].style.backgroundColor=t},setItemToStorage:function(e,t){Demandbase.Utilities.isStorageEnabled("sessionStorage")?sessionStorage.setItem(e,t):Demandbase.Utilities.isStorageEnabled("localStorage")?localStorage.setItem(e,t):Demandbase.Utilities.isCookieEnabled()?document.cookie=e+"="+t:this.configuration.state[e]=t},setStyles:function(){this.setFontColor(this.configuration.fontColor),this.configuration.mainClass===this.CLASS_MAIN_BOTTOM&&this.setItemBackgroundColor(this.configuration.itemBackgroundColor),this.setWidgetBackgroundColor(this.configuration.widgetBackgroundColor),this.setFontFamily(this.configuration.fontName)},setWidgetBackgroundColor:function(e){var t=void 0!==e?e:this.configuration.widgetBackgroundColor;document.getElementsByClassName(this.CLASS_ROOT)[0].style.backgroundColor=t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},toggleClass:function(e,t,n){void 0===n&&(n=!this.hasClass(e,t)),n?this.addClass(e,t):this.removeClass(e,t)},alignListViewBlock:function(e){document.body.clientHeight!==window.innerHeight&&this.configuration.additionalClass===this.CLASS_RIGHT_RAIL&&this.addClass(e,"right-margined")},recommendationRequest:function(){new XMLHttpRequest;var e=this.configuration.recommendationUrl,t=this;this.getRecommendations(this.configuration.recommendationCompanyId,e,this.configuration.recommendationKey,function(e){e.recommendations&&(e.recommendations.length<1||(t.overrideSid()&&(t.configuration.recommendationCompanyName=e.company_name),t.documentReady(e)))})},buildContentOfClosedBlock:function(e){var t=[],n=document.createElement(this.DIV);this.addClass(n,this.CLASS_CLOSED_CONTENT),this.configuration.showTitleWhenClosed&&t.push(this.buildClosedTitle()),Array.prototype.forEach.call(t,function(e,t){n.appendChild(e)}),e.appendChild(n)},buildContentOfOpenedBlock:function(e){var t=[],n=document.createElement(this.DIV);this.addClass(n,this.CLASS_OPEN_CONTENT),this.configuration.showCloseButton&&t.push(this.buildCloseButton()),(this.configuration.showLogoWhenOpen||this.configuration.showTitleWhenOpen)&&t.push(this.buildOpenedTitleWrapper(this.configuration.showTitleWhenOpen)),t.push(this.buildSlidesList()),this.configuration.showFeedbackLink&&t.push(this.buildFeedbackLink()),Array.prototype.forEach.call(t,function(e,t){n.appendChild(e)}),e.appendChild(n)},addCustomStyles:function(e){var t=document.createElement("style");return this.configuration.customCSS&&(t.type="text/css",t.appendChild(document.createTextNode(this.configuration.customCSS)),e.appendChild(t)),t},setFadeInOnScroll:function(t){var e=this;0!==this.configuration.fadeIn&&-1!==this.configuration.fadeIn&&t.setAttribute("style","transition: opacity "+this.configuration.fadeIn/1e3+"s;");var n=this;this.configuration.showOnlyOnScroll?window.onscroll=function(){t.style.opacity<1&&(t.style.opacity=1,e.sendGoogleAnalyticsEvent("AI personalization - Company Logo","impression","Company SID: "+e.configuration.recommendationCompanyId)),n.onscroll(n,t)}:(setTimeout(function(){t.style.opacity=1},this.configuration.delay||0),window.onscroll=function(e){n.onscroll(n,t)})},createWidgetWrapper:function(){var e=document.createElement(this.DIV);return this.addClass(e,this.CLASS_ROOT),this.configuration.mainClass===this.CLASS_RIGHT_RAIL||this.configuration.openByDefault||"true"===this.getItemFromStorage(this.SESSION_BLOCK_OPEN_STATE)?this.addClass(e,this.CLASS_OPENED):this.addClass(e,this.CLASS_CLOSED),e},addClassesForWidget:function(e){this.addClass(e,this.configuration.mainClass),this.configuration.additionalClass&&this.addClass(e,this.configuration.additionalClass),this.configuration.backgroundColorClass&&this.addClass(e,this.configuration.backgroundColorClass)},onTouchCallback:function(e,t,n,i,o){var a,s=this,r=function(){s.removeClass(c,s.CLASS_OPENED),s.addClass(c,s.CLASS_CLOSED),s.setItemToStorage(s.SESSION_BLOCK_OPEN_STATE,"false")},l=function(){s.removeClass(c,s.CLASS_CLOSED),s.addClass(c,s.CLASS_OPENED),s.setItemToStorage(s.SESSION_BLOCK_OPEN_STATE,"true")},c=document.querySelector("."+s.CLASS_ROOT),d=c.querySelectorAll("."+s.CLASS_LIST)[0],m=d.querySelectorAll("."+s.CLASS_LIST_ITEM),u=850<window.innerWidth?3:2,h=Math.ceil(m.length/u),_=d.parentNode.clientWidth;if("end"===n){var S=(_-m[0].clientWidth*u)/(2*u);if(a=-_*(h-1)+(m.length%u?(2*S+m[0].clientWidth)*(u-m.length%u):0),"right"==t&&0<parseInt(d.style.left)||"left"==t&&m.length<=u?d.style.left="0px":"left"==t&&Math.abs(parseInt(d.style.left))>-a&&(d.style.left=a+"px"),"right"!=t&&"left"!=t||(this.toggleClass(document.querySelector(".recommendation-block__arrows-list_common.left-arrow"),"_inactive",0===parseInt(d.style.left)),this.toggleClass(document.querySelector(".recommendation-block__arrows-list_common.right-arrow"),"_inactive",Math.abs(parseInt(d.style.left))===Math.floor(Math.abs(a)))),0,"none"===t)if(e.target.className!==s.CLASS_CLOSE_BUTTON){if(s.hasClass(c,s.CLASS_CLOSED))l();else if(this.configuration.mainClass===s.CLASS_MAIN_BOTTOM)if(s.hasClass(e.target,"affect")||!s.hasClass(e.target,"right-arrow")&&!s.hasClass(e.target,"left-arrow"))if(s.hasClass(e.target,"recommended-block_arrows-part")||s.hasClass(e.target,"round"))if(s.hasClass(e.target.offsetParent,"right-arrow"))c.querySelectorAll(".right-arrow .recommended-block_arrows-part")[0].click();else c.querySelectorAll(".left-arrow .recommended-block_arrows-part")[0].click();else s.hasClass(e.target.offsetParent,s.CLASS_LIST_ITEM)&&e.target.offsetParent.querySelectorAll("."+s.CLASS_LIST_ITEM_TITLE)[0].click();else r()}else s.hasClass(c,s.CLASS_OPENED)&&r();else"up"==t?s.hasClass(c,s.CLASS_CLOSED)&&l():"down"==t&&s.hasClass(c,s.CLASS_OPENED)&&r()}else"move"!=n||"right"!=t&&"left"!=t||(d.style.transition="left 1s",d.style.left=parseInt(d.style.left)+o+"px")},documentReady:function(t){var n=this;Demandbase.ErrorReporter.wrap(function(){if(!1!==t.should_display){var e=n.createWidgetWrapper();n.addCustomStyles(e),n.alignListViewBlock(e),n.addClassesForWidget(e),n.buildContentOfClosedBlock(e),n.buildContentOfOpenedBlock(e),n.addAnimation(e),n.insertWidget(e),n.configuration.showOnlyOnScroll||n.sendGoogleAnalyticsEvent("AI personalization - Company Logo","impression","Company SID: "+n.configuration.recommendationCompanyId),n.setFadeInOnScroll(e),n.configuration.mainClass===n.CLASS_MAIN_BOTTOM&&n.ontouch(e,n.onTouchCallback.bind(n)),n.DOMmanipulations(t)}})()},onscroll:function(e,t){window.innerHeight+window.scrollY>=document.body.scrollHeight?e.hasClass(t,e.CLASS_HIDDEN)||e.configuration.mainClass!==window.Demandbase.SiteOptimization.CLASS_MAIN_BOTTOM||e.addClass(t,e.CLASS_HIDDEN):e.hasClass(t,e.CLASS_HIDDEN)&&e.removeClass(t,e.CLASS_HIDDEN)},ontouch:function(e,t){var n,i,o,a,s,r,l,c=e,d=t||function(e,t,n,i,o){};Demandbase.Utilities.addEventListener(c,"touchstart",function(e){var t=e.changedTouches[0];i=n="none",o=t.pageX,a=t.pageY,l=(new Date).getTime(),e.preventDefault()}),Demandbase.Utilities.addEventListener(c,"touchmove",function(e){var t=e.changedTouches[0];s=t.pageX-o,r=t.pageY-a,Math.abs(s)>Math.abs(r)?d(e,n=s<0?"left":"right","move",i,s):d(e,n=r<0?"up":"down","move",i,r),e.preventDefault()}),Demandbase.Utilities.addEventListener(c,"touchend",function(e){(new Date).getTime()-l<=500&&(150<=Math.abs(s)&&Math.abs(r)<=100?i=n:150<=Math.abs(r)&&Math.abs(s)<=100&&(i=n)),d(e,n,"end",i,"left"===n||"right"===n?s:r),e.preventDefault()})},onWidgetClick:function(t){var n=this;Demandbase.Utilities.addEventListener(t,"click",function(e){e.target.className!==n.CLASS_CLOSE_BUTTON&&(n.hasClass(t,n.CLASS_CLOSED)?(n.removeClass(t,n.CLASS_CLOSED),n.addClass(t,n.CLASS_OPENED),n.setItemToStorage(n.SESSION_BLOCK_OPEN_STATE,"true"),n.sendGoogleAnalyticsEvent("AI personalization - Company Logo","click: open block","Company SID: "+n.configuration.recommendationCompanyId)):n.configuration.mainClass===n.CLASS_MAIN_BOTTOM&&(n.hasClass(e.target,"affect")||n.hasClass(e.target.parentNode,"affect")||(n.removeClass(t,n.CLASS_OPENED),n.addClass(t,n.CLASS_CLOSED),n.setItemToStorage(n.SESSION_BLOCK_OPEN_STATE,"false"),n.sendGoogleAnalyticsEvent("AI personalization - Company Logo","click: open block","Company SID: "+n.configuration.recommendationCompanyId))))})},sendFeedback:function(e){var t=new XMLHttpRequest,n={served_sid:parseInt(this.configuration.recommendationCompanyId),corrected_company_name:e,url:window.location.href};t.open("POST","https://ai-personalization-prod-api.demandbase.com/feedback",!0),t.setRequestHeader("Content-type","application/json"),t.onload=this.feedbackResponseHandler.bind(this,t),t.send(JSON.stringify(n))},feedbackInputKeyupCallback:function(e){(void 0!==e.key&&"Enter"==e.key||void 0!==e.keyCode&&("Enter"==e.keyCode||13==e.keyCode))&&this.sendFeedback(e.target.value)},onFeedbackSend:function(){var e=document.querySelector(".recommended-block__feedbackLinkDiv__popup__input");e&&Demandbase.Utilities.addEventListener(e,"keyup",this.feedbackInputKeyupCallback.bind(this))},onCloseWidget:function(e,t){var n=document.querySelectorAll("."+e.CLASS_CLOSE_BUTTON)[0];n&&Demandbase.Utilities.addEventListener(n,"click",function(){e.hasClass(t,e.CLASS_OPENED)&&(e.removeClass(t,e.CLASS_OPENED),e.addClass(t,e.CLASS_CLOSED),e.setItemToStorage(e.SESSION_BLOCK_OPEN_STATE,"false"))})},buildItems:function(e,t){e.recommendations&&this.buildRecommendationsItems(t,e.recommendations,"."+this.CLASS_LIST)},buildLogo:function(e,t){if(e.logo&&this.configuration.showLogo){if(this.configuration.showLogoWhenClosed){var n=document.querySelectorAll("."+this.CLASS_TITLE)[0];this.addClass(document.querySelectorAll("."+this.CLASS_CLOSED_CONTENT)[0],"mrg-btm"),document.querySelectorAll("."+this.CLASS_CLOSED_CONTENT)[0].insertBefore(this.buildOpenedOrClosedLogo(e.logo),n)}if(this.configuration.showLogoWhenOpen){var i=document.querySelectorAll("."+this.CLASS_OPEN_TITLE)[0];document.querySelectorAll("."+this.CLASS_OPEN_TITLE_WRAPPER)[0].insertBefore(this.buildOpenedOrClosedLogo(e.logo),i)}}},buildWidgetToggle:function(e){var t=e.querySelectorAll("."+this.CLASS_LIST+" ."+this.CLASS_LIST_ITEM);this.configuration.isSwitchersDots&&this.buildSwitcher(e,t.length),this.configuration.isSwitchersArrows&&this.buildArrows(e,t.length)},DOMmanipulations:function(t){var n=this,i=document.querySelectorAll("."+this.CLASS_ROOT)[0];this.onWidgetClick(i),this.addFeedbackClickHandler(this),this.onFeedbackSend(this),this.onCloseWidget(this,i),this.buildItems(t,i),this.checkLogoImageIsAvailable(t.logo,function(e){return n.buildLogo(t,i)}),this.buildWidgetToggle(i),this.setStyles()},ready:function(e){var t=this;"loading"!==document.readyState?Demandbase.ErrorReporter.wrap(function(){return e.call(t)})():Demandbase.Utilities.addEventListener(document,"DOMContentLoaded",Demandbase.ErrorReporter.wrap(e.bind(this))())},getRecommendations:function(e,t,n,i,o,a,s){var r=new XMLHttpRequest,l=window.btoa(t),c=(a||this.configuration.recommendationApiURL)+encodeURI(e)+"?page="+encodeURI(l)+"&apiKey="+encodeURI(n);s&&(c+="&solveConversionProbabilities=true"),r.open("GET",c,!0),r.withCredentials=!0,r.onload=function(){if(200<=r.status&&r.status<400){var e=JSON.parse(r.responseText);i&&i(e)}else o&&o()},r.onerror=function(){o()},r.send()},buildRecommendationsItems:function(e,t,n){var i=0!==e.querySelectorAll(n).length?e.querySelectorAll(n)[0]:e.querySelectorAll("."+this.CLASS_LIST)[0];i.innerHTML="";var o=6,a=3;this.configuration.additionalClass&&(a=o),t.length<6&&(o=t.length);for(var s="",r="",l=0;l<o;l++){this.configuration.mainClass!==this.CLASS_MAIN_BOTTOM&&a-1<l&&(r='style="display:none"'),0===l&&(r='style="left:0"'),s+='<li class="'+this.CLASS_LIST_ITEM+' affect"'+r+">",this.isAdmin&&(s+=this.buildConversionPopup(t[l]));var c="http://";"forceHTTPS"===this.configuration.recommendationsProtocol&&(c="https://");var d=t[l].title;d=d.length<=95?d:d.substring(0,95)+"...";var m=this.getIndicatorArrow();s+='<div class="recommended-block__list__recommended-item__image-wrapper"><div class="recommended-block__list__recommended-item__image-table-row-wrapper"><div class="recommended-block__list__recommended-item__image-table-cell-wrapper"><a onclick="window.Demandbase.SiteOptimization.itemOnClick(event)" href="'+c+t[l].page+'"><img src="'+t[l].image+'" alt="Preview" class="recommended-block__list__recommended-item__img"></div></div></a><a onclick="window.Demandbase.SiteOptimization.itemOnClick(event)" class="'+this.CLASS_LIST_ITEM_TITLE+'" href="'+c+t[l].page+'">'+d+m+"</a></div></li>"}i.innerHTML=s},itemOnClick:function(e){var t=this.findAncestor(e.target,this.CLASS_LIST_ITEM),n=document.querySelectorAll("."+this.CLASS_LIST)[0],i=Array.prototype.indexOf.call(n.children,t),o="";o=this.hasClass(e.target,"recommended-block__list__recommended-item__img")?e.target.parentNode.getAttribute("href"):e.target.getAttribute("href"),this.sendGoogleAnalyticsEvent("AI personalization - Content recommendation","click","Destination URL:"+o+" | Location of the asset:"+i)},buildSwitcher:function(e,t){var o=474;this.configuration.mainClass!==this.CLASS_MAIN_DEFAULT&&(o=297);var n=t%3==0?t/3:t/3+1,a=e.querySelectorAll("."+this.CLASS_LIST)[0];if(1<n){for(var i='<li class="'+this.CLASS_SWITCHER_CONTROL_ITEM+' _active"></li>',s='<li class="'+this.CLASS_SWITCHER_CONTROL_ITEM+'"></li>',r=document.querySelectorAll("."+this.CLASS_SWITCHER_CONTROL)[0],l="",c=n-1;0<c;c--)l+=s;r.innerHTML=i+l;var d=r.querySelectorAll("."+this.CLASS_SWITCHER_CONTROL_ITEM),m=this;Array.prototype.forEach.call(d,function(n,i){Demandbase.Utilities.addEventListener(n,"click",function(e){if(!m.hasClass(n,"_active")){Array.prototype.forEach.call(d,function(e,t){m.removeClass(e,"_active")}),m.addClass(n,"_active"),a.style.left=-1*o*i+"px";var t=a.querySelectorAll("."+m.CLASS_LIST_ITEM);Array.prototype.forEach.call(t,function(e,t){e.style.left=o*i+"px",Math.floor(t/3)===i?e.style.display="block":e.style.display="none"})}})})}},buildOpenedOrClosedLogo:function(e){var t=window.Demandbase.SiteOptimization,n=document.createElement(t.DIV);return t.addClass(n,t.CLASS_LOGO_WRAPPER),n.innerHTML='<img src="'+e+'" alt="Company Logo" class="recommended-block__logo-wrapper__logo">',n},checkLogoImageIsAvailable:function(e,t){var n=new Image;n.onload=function(){return t({logoUrl:e})},n.onerror=function(e){},n.src=e},buildArrows:function(e,t){var n=e.querySelectorAll(".recommendation-block__arrows-list")[0];if(3<=t){var i="";this.configuration.switcherArrowsColor&&(i='style="border-color: '+this.configuration.switcherArrowsColor+'"');var o="<div "+i+" class='recommended-block_arrows-part affect'></div>";n.innerHTML="<div class='recommendation-block__arrows-list_common left-arrow _inactive'><div class='recommended-block_arrows-part_round affect'></div>"+o+"</div><div class='recommendation-block__arrows-list_common right-arrow'><div class='recommended-block_arrows-part_round affect'></div>"+o+"</div>";var a=n.querySelector(".left-arrow .recommended-block_arrows-part"),s=n.querySelector(".right-arrow .recommended-block_arrows-part"),r=e.querySelectorAll("."+this.CLASS_LIST)[0],l=r.querySelectorAll("."+this.CLASS_LIST_ITEM);r.style.left="0";var c=this,d=function(){var e=l.length,t=850<window.innerWidth?3:2;return{sliderWrapperWidth:r.parentNode.clientWidth,numberOfSlidesInSection:t,sliderPosition:Math.abs(parseInt(r.style.left)),numberOfSections:Math.ceil(e/t)}};Demandbase.Utilities.addEventListener(a,"click",function(){var e=d();e.sliderPosition&&(r.style.left=e.sliderPosition/e.sliderWrapperWidth<1?"0px":-e.sliderWrapperWidth*(Math.ceil(e.sliderPosition/e.sliderWrapperWidth)-1)+"px"),m(r.style.left,e.sliderWrapperWidth,e.numberOfSections,!1)}),Demandbase.Utilities.addEventListener(s,"click",function(){var e=d(),t=!1;if(e.sliderPosition<e.sliderWrapperWidth*(e.numberOfSections-1)){var n=-e.sliderWrapperWidth*Math.floor(1+e.sliderPosition/e.sliderWrapperWidth),i=(e.sliderWrapperWidth-l[0].clientWidth*e.numberOfSlidesInSection)/(2*e.numberOfSlidesInSection);if(l.length%e.numberOfSlidesInSection&&Math.abs(n)===(e.numberOfSections-1)*e.sliderWrapperWidth)n+=(2*i+l[0].clientWidth)*(e.numberOfSlidesInSection-l.length%e.numberOfSlidesInSection),t=!0}r.style.left=n+"px",m(r.style.left,e.sliderWrapperWidth,e.numberOfSections,t)});var m=function(e,t,n,i){c.toggleClass(a.parentNode,"_inactive",0===Math.abs(parseInt(e))),c.toggleClass(s.parentNode,"_inactive",i||Math.abs(parseInt(e))===(n-1)*t)}}if(3===t)for(var u=document.querySelectorAll(".recommended-block_arrows-part"),h=0;h<u.length;h++)u[h].style.display="none";return n},overrideSid:function(){var e=this.getQueryVariable("sid");return e||null},applyOverrideSid:function(e){return e.demandbase_sid=this.overrideSid()?this.overrideSid():e.demandbase_sid,e},isPersonalizationBlacklist:function(e){for(var t=0;t<this.PERSONALIZATION_BLACKLIST_DOMAINS.length;t++)if(this.PERSONALIZATION_BLACKLIST_DOMAINS[t]===e)return!0;return!1},setRecommendationsData:function(e){e=this.applyOverrideSid(e),(this.configuration.companyProfile=e).demandbase_sid&&(this.configuration.recommendationCompanyId=e.demandbase_sid,this.configuration.recommendationCompanyName=e.marketing_alias,e.web_site&&this.isPersonalizationBlacklist(e.web_site)&&(this.configuration.showLogo=!1,this.configuration.recommendationCompanyName=""),this.ready(this.recommendationRequest))},checkInitialData:function(){var t=new XMLHttpRequest,e="https://api.company-target.com/api/v2/ip.json?key="+encodeURI(this.configuration.recommendationKey)+"src=siteOptimization";t.open("GET",e,!0);var n=this;t.onload=function(){if(200<=t.status&&t.status<400){var e=JSON.parse(t.responseText);n.setRecommendationsData(e)}},t.onerror=function(){},t.send()},getQueryVariable:function(e){return Demandbase.Utilities.getQueryParam(e)}},void 0!==window.Demandbase.Config&&void 0!==window.Demandbase.Config.SiteOptimization&&void 0!==window.Demandbase.SiteOptimizationLoader&&Demandbase.ErrorReporter.wrap(function(){window.Demandbase.SiteOptimization.initialize(window.Demandbase.SiteOptimizationLoader.configuration)})();